@inject Inventory.Client.Shared.PageHistoryState PageHistoryState

<EditForm Model="@purchase" OnValidSubmit="@OnValidSubmit">
    <FluentValidator TValidator="PurchaseMasterValidator" />
    <hr />
    <h3>Purchase</h3>
    <div class="form-row">
        <div class="form-group col-md-3">
            <label>Item</label>
        </div>
        <div class="form-group col-md-3">
            <label>Price</label>
        </div>
        <div class="form-group col-md-3">
            <label>Quantity</label>
        </div>
    </div>
    <ValidationMessage For="@(() => purchase.purchaseDetails)" />
    @foreach (var d in purchase.purchaseDetails)
    {
        <div class="form-row">
            <div class="form-group col-md-3">
                <InputText id="ItemId" class="form-control" placeholder="item" />
                <ValidationMessage For="@(() => d.ItemId)" />
            </div>
        </div>
        <div class="form-group col-md-3">
            <InputText id="Price" class="form-control" placeholder="Price" />
            <ValidationMessage For="@(() => d.Price)" />
        </div>
        <div class="form-group col-md-3">
            <InputText id="Quantity" class="form-control" placeholder="Quantity" />
            <ValidationMessage For="@(() => d.Quantity)" />
        </div>

        <div class="Form-group">
            <a href="javascript:void(0)" class="btn btn-danger" @onclick="@(()=>OnDetailsDelete(purchase, d))">X</a>
        </div>
    }
    <div class="form-group">
        <a href="javascript:void(0)" class="btn btn-success" @onclick="@(()=>OnDetailsAdd(purchase))">Add Address</a>
    </div>
    <hr />
    <div class="form-group">
        <button disabled="@loading" class="btn btn-primary">
            @if (loading)
            {
                <span class="spinner-border spinner-border-sm mr-1"></span>
            }
            @ButtonText
        </button>
        @if (PageHistoryState.CanGoBack())
        {
            <NavLink href="@PageHistoryState.GetGoBackPage()" class="btn btn-link">Cancel</NavLink>
        }
        else
        {
            <NavLink href="/purchase/1" class="btn btn-link">Back</NavLink>
        }
    </div>
</EditForm>

@code {
    [Parameter]
    public Inventory.Shared.Model.PurchaseMaster purchase { get; set; }
    [Parameter]
    public string ButtonText { get; set; } = "Save";
    [Parameter]
    public bool loading { get; set; } = false;
    [Parameter]
    public EventCallback OnValidSubmit { get; set; }

    public void OnDetailsDelete(Inventory.Shared.Model.PurchaseMaster purchase, Inventory.Shared.Model.PurchaseDetails details)
    {
        purchase.purchaseDetails.Remove(details);
    }

    public void OnDetailsAdd(Inventory.Shared.Model.PurchaseMaster purchase)
    {
        purchase.purchaseDetails.Add(new PurchaseDetails { ItemId = 0, Price = 0, Quantity = 0 });
    }
}